---
title: "Mammalian sleep patterns"
format: 
  html:
    theme: simplex
    embed-resources: true
---

```{r}
#| include: false
library("knitr")
library("ggplot2")
theme_set(theme_minimal(base_size = 14))
```

## Mammal sleep data

We will be working with the `msleep` data set that is provided with ggplot2. The data set contains information about the sleep habits of 83 mammals.

Let's say we want to show a few rows of the `msleep` data in the report. You can use the base R function `head()` to see the first few rows of data:

```{r}
head(msleep)
```

But that's sort of ugly, and the output is cut off. Now try wrap this same command in the `knitr` function `kable()` to create a nice-looking table.

```{r}
kable(head(msleep))
```

## Problem 1

Create a scatter plot of total time asleep (y) vs. brain weight (x), colored by "vore" (carnivore, herbivore, etc.).

```{r}
#| fig-height: 6
#| fig-width: 9
# Your R code goes here
```

**Answer the following questions:** 

- Note that we obtained a warning from R about 27 rows of containing missing values (we will hide the warnings in the plots below). Examine the data carefully to determine why the warning is being generated.
- What *perceptual* problems does this figure have, and what change could you make to show the data more effectively? 
- What specifically causes these problems?

<!-- Write your answers below. -->

<!-- Write your answers above. -->

<br>

## Problem 2

Create a new scatter plot of total time asleep vs. brain weight colored by vore, but this time when you plot the variables, consider whether a linear scale or a logarithmic scale seems more appropriate. **HINT:** Use the functions `scale_x_log10()` and/or `scale_y_log10()` to change the scales of the x-axis and y-axis, respectively.

```{r}
#| fig-height: 6
#| fig-width: 9
#| warning: false
# Your R code goes here
```

**Answer the following questions:** 

- Explain your reasoning for which scale transformations are most appropriate for displaying the data.
- In your opinion, what is the main story told by this visualization?

<!-- Write your answers below. -->

<!-- Write your answers above. -->

<br>

## Problem 3

Create the same plot of total time asleep vs. brain weight, colored by "vore," but this time label the points using the name of the animal.

**HINT:** Use the function `geom_text()` and be sure to supply it with the proper aesthetic (type `?geom_text()` and see the bolded entries under "Aesthetics" in the help file). 

```{r}
#| fig-height: 8
#| fig-width: 9
#| warning: false
# Your R code goes here
```

**Answer the following questions:** 

- What perceptual problems does this figure have?

<!-- Write your answers below. -->

<!-- Write your answers above. -->

<br>

## Problem 4

This was all an elaborate setup to introduce you to the `ggrepel` package, which is one example of the many helpful "extensions" that people have created for `ggplot2`. Load this package in the usual way: 

```{r}
library("ggrepel")
```

Now, modify the same plot of total time asleep vs. brain weight, colored by "vore" and labeled with the name of the animal. But this time, instead of using `geom_text()`, use the `geom_text_repel()` function provided by this packages.

```{r}
#| fig-height: 6
#| fig-width: 9
#| warning: false
# Your R code goes here
```

**Answer the following questions:** 

- What has changed in your figure?
- How does the change improve the interpretability of the data?

<!-- Write your answers below. -->

<!-- Write your answers above. -->

<br>

## Problem 5

Add a linear regression line to the plot using the function `geom_smooth()`.

**Hint:** A regression line can be added with the function `geom_smooth(method = "lm")` ("lm" stands for "linear model").

Play around with the relative position of the smoothed line by putting it above or below the other geoms. Try also to use `se = FALSE` to see the line without a confidence region around the smooth.

```{r}
#| fig-height: 6
#| fig-width: 9
#| warning: false
# Your R code goes here
```

**Answer the following questions:** 

- How has the addition of the line changed the figure's interpretability? 
- Can you find any interesting "stories" in the data that have been revealed?

<!-- Write your answers below. -->

<!-- Write your answers above. -->
